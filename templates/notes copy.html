<!DOCTYPE HTML>

<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="/static/css/styles.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        <title>My Notes</title>
    </head>
    <body class="notes">
        <div class="notes__box">
            <p class="notes__header">My Notes ✏️</p>
            <button type="button" id="save" onclick="saveNotes()">Save</button>
            <button type="button" id="create" onclick="createNote()">Create</button>
            <ul id="notes">
                {% for note in notes %}
                <li class="sticky__note">
                    <a href="#" contenteditable>
                        <h2 class="note__title">{{ note[0] }}</h2>
                        <i class="bi bi-trash" id="{{ note[3] }}" onclick="deleteNotes(this.id)" style="float: right; color: #fa5246; cursor: pointer;"></i>
                        <p class="note__content">{{ note[1] }}</p>
                    </a>
                </li>
                {% endfor %}
                <script>
                    function createNote() {
                        $(document).ready(function () {
                            var noteTitle = [];
                            $("li.sticky__note").find("h2").each(function (index, ele) {
                                noteTitle.push(ele.innerHTML);
                            });
                            var total_sticky_notes = noteTitle.length + 1;
                            store_sticky_note(total_sticky_notes);
                            
                        });

                        function store_sticky_note(total_sticky_notes) {
                            var sticky_not_data = {
                                "action": "create",
                                "noteTitle": "Note title",
                                "noteContent": "Note content",
                                "noteId": "note" + total_sticky_notes
                            }
                                
                            fetch(`/notes/`, {
                                method: "POST",
                                body: JSON.stringify(sticky_not_data),
                                headers: new Headers ({
                                    'accept': 'application/json',
                                    'content-type': 'application/json'
                                })
                            });

                            location.reload();
                        }
                    }
                </script>
            </ul>
        </div>

        <script>
            $(document).ready(function () {
                all_notes = $("li a");
              
                all_notes.on("keyup", function () {
                    note_title = $(this).find("h2").text();
                    note_content = $(this).find("p").text();
              
                    item_key = "list_" + $(this).parent().index();
              
                    data = {
                        title: note_title,
                        content: note_content
                    };
              
                    window.localStorage.setItem(item_key, JSON.stringify(data));
                });
              
                all_notes.each(function (index) {
                    data = JSON.parse(window.localStorage.getItem("list_" + index));
              
                    if (data !== null) {
                        note_title = data.title;
                        note_content = data.content;
              
                        $(this).find("h2").text(note_title);
                        $(this).find("p").text(note_content);
                    }
                });
            });

            function deleteNotes(id) {
                var noteId = id;
                var sticky_not_data = {
                    "action": "delete",
                    "noteId": noteId
                }

                fetch(`/notes/`, {
                    method: "POST",
                    body: JSON.stringify(sticky_not_data),
                    headers: new Headers ({
                        'accept': 'application/json',
                        'content-type': 'application/json'
                    })
                });

                location.reload();
                
            }

            $(document).ready(function () {
                var noteTitle = [];
                var noteContent = [];
                
                $("li.sticky__note").find("h2").each(function (index, ele) {
                    noteTitle.push(ele.innerHTML);
                });

                $("li.sticky__note").find("p").each(function (index, ele) {
                    noteContent.push(ele.innerHTML);
                });
                
                console.log(noteTitle);
                console.log(noteContent);
            });
        </script>
        
        <div class="footer">
            <div class="footer-content__top" onclick="showAbout()">About
                <span class="popuptext" id="about">This is a test project. Developed & designed for fun and test purposes.</span>
            </div>
            <div class="footer-content__bottom" id="worldClock"></div>
            <script>
                // opens the about popup
                function showAbout() {
                    var popup = document.getElementById("about");
                    popup.classList.toggle("show");
                    hideAbout();
                }

                function hideAbout() {
                    var popup = document.getElementById("about");
                    setTimeout(function() {
                        popup.classList.remove("show");
                    }, 5000); // time in milliseconds                    
                }

                // world clock
                const displayTime = document.querySelector("#worldClock");
                // Time
                function showTime() {
                let time = new Date();
                displayTime.innerText = time.toLocaleTimeString("en-US", { hour12: false });
                setTimeout(showTime, 1000);
                }

                showTime();
            </script>
        </div>
    </body>
</html>